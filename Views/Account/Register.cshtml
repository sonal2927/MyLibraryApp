@model LibraryManagementSystem.Models.User
@{
    ViewData["Title"] = "Register";
}

<h2 class="mb-4 text-center">ğŸ“ User Registration</h2>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">@ViewBag.Error</div>
}

<form asp-action="Register" method="post" class="border p-4 rounded bg-light shadow-sm w-50 mx-auto">
    @Html.AntiForgeryToken()

    <div class="mb-3">
        <label asp-for="Role" class="form-label fw-semibold">ğŸ­ Role</label>
        <select asp-for="Role" class="form-select" id="roleDropdown" required>
            <option value="">-- Select Role --</option>
            <option value="Student">Student</option>
            <option value="Faculty">Faculty</option>
            <option value="Librarian">Librarian</option>
        </select>
    </div>

    <div class="mb-3">
        <label asp-for="Department" class="form-label fw-semibold">ğŸ« Department</label>
        <select asp-for="Department" class="form-select" id="departmentDropdown" required>
            <option value="">-- Select Department --</option>
        </select>
    </div>

    <div class="mb-3">
        <label asp-for="FullName" class="form-label fw-semibold">ğŸ‘¤ Full Name</label>
        <input asp-for="FullName" class="form-control" required />
    </div>

    <div id="enrollmentField" class="mb-3">
        <label asp-for="EnrollmentNumber" class="form-label fw-semibold">ğŸ†” Enrollment No.</label>
        <input asp-for="EnrollmentNumber" class="form-control" />
    </div>

    <div id="yearField" class="mb-3">
        <label asp-for="Year" class="form-label fw-semibold">ğŸ“… Year</label>
        <select asp-for="Year" class="form-select">
            <option value="">-- Select Year --</option>
            <option>1st Year</option>
            <option>2nd Year</option>
            <option>3rd Year</option>
            <option>4th Year</option>
        </select>
    </div>

    <div id="semesterField" class="mb-3">
        <label asp-for="Semester" class="form-label fw-semibold">ğŸ“˜ Semester</label>
        <select asp-for="Semester" class="form-select">
            <option value="">-- Select Semester --</option>
            <option>Semester 1</option>
            <option>Semester 2</option>
            <option>Semester 3</option>
            <option>Semester 4</option>
            <option>Semester 5</option>
            <option>Semester 6</option>
            <option>Semester 7</option>
            <option>Semester 8</option>
        </select>
    </div>

    <div class="mb-3">
        <label asp-for="Email" class="form-label fw-semibold">ğŸ“§ Email</label>
        <input asp-for="Email" class="form-control" type="email" required />
    </div>

    <div class="mb-3">
        <label asp-for="Phone" class="form-label fw-semibold">ğŸ“± Phone</label>
        <input asp-for="Phone" class="form-control" required />
    </div>

    <div class="mb-3">
        <label asp-for="Gender" class="form-label fw-semibold">âš§ï¸ Gender</label>
        <select asp-for="Gender" class="form-select" required>
            <option value="">-- Select Gender --</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
        </select>
    </div>

    <div class="mb-3">
        <label asp-for="Password" class="form-label fw-semibold">ğŸ”‘ Password</label>
        <input asp-for="Password" class="form-control" type="password" required />
    </div>

    <div class="mb-3">
        <label asp-for="ConfirmPassword" class="form-label fw-semibold">ğŸ”’ Confirm Password</label>
        <input asp-for="ConfirmPassword" class="form-control" type="password" required />
    </div>

    <div class="d-grid mt-3">
        <button type="submit" class="btn btn-primary fw-bold">ğŸš€ Register</button>
    </div>
</form>

@section Scripts {
    <script>
        const roleDropdown = document.getElementById("roleDropdown");
        const departmentDropdown = document.getElementById("departmentDropdown");
        const enrollmentField = document.getElementById("enrollmentField");
        const yearField = document.getElementById("yearField");
        const semesterField = document.getElementById("semesterField");

        const departments = {
            Student: ["CSE", "IT", "Mechanical", "Civil", "Chemical", "Electrical"],
            Faculty: ["CSE", "IT", "Mechanical", "Civil", "Chemical", "Electrical"],
            Librarian: ["Senior Librarian", "Librarian", "Assistant Librarian"]
        };

        function toggleStudentFields(role) {
            const isStudent = role === "Student";
            enrollmentField.style.display = isStudent ? "block" : "none";
            yearField.style.display = isStudent ? "block" : "none";
            semesterField.style.display = isStudent ? "block" : "none";
        }

        roleDropdown.addEventListener("change", function () {
            const selectedRole = this.value;

            // department change
            departmentDropdown.innerHTML = '<option value="">-- Select Department --</option>';
            if (departments[selectedRole]) {
                departments[selectedRole].forEach(dept => {
                    const option = document.createElement("option");
                    option.value = dept;
                    option.textContent = dept;
                    departmentDropdown.appendChild(option);
                });
            }

            // show/hide student fields
            toggleStudentFields(selectedRole);
        });

        // Initial call on page load
        toggleStudentFields(roleDropdown.value);
    </script>
}
